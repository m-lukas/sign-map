<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Schilder-Übersicht</title>
    <script type='text/javascript' src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANVBn98XfLAjJ8iK-fG6v63LuW3uc88X4"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
    <script src="USGSOverlay.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>
    <div class="mapWrapper">
        <div id="map"></div>
        <div class="sidebar">
            <div class="ov">
              <div class="ov-header">
                  <button class="ov-button ov-close" onclick="unselectMarker()">X</button>
                  <h1 id="ov-id">#465</h1>
                  <h2 id="ov-name">Lust zum Matschen und Bauen? - Milchspielplatz</h2>
              </div>
              <div class="ov-body">
                  <div class="ov-wrapper">
                    <p class="ov-label">KATEGORIE</p>
                    <p id="ov-category" class="ov-value">
                      P1 - Sondertafel/Spiele
                      <div id="ov-category-indicator"></div>
                    </p>  
                  </div>
                  <div class="ov-wrapper">
                    <p class="ov-label">GEBOGEN</p>
                    <p id="ov-bent" class="ov-value">Nicht gebogen</p>
                  </div>
                  <div class="ov-wrapper">
                    <p class="ov-label">SPEICHERORT</p>
                    <p id="ov-dirPath" class="ov-value">C://</p>
                  </div>
                  <div class="ov-wrapper">
                    <p class="ov-label">GEÄNDERT AM</p>
                    <p id="ov-date" class="ov-value">06.01.2019</p>  
                  </div>
                  <div class="ov-footer">
                      <button class="ov-button ov-footer-button" onclick="moveMarker()">
                          <img src="images/Pen.png" alt="move">
                      </button>
                      <button class="ov-button ov-footer-button" onclick="editMarker()">
                        <img src="images/Path 2683.png" alt="edit">
                      </button>
                  </div>
              </div>
            </div>
            <div id="filters">
              <div class="filter filter-active" onclick="onFilter(this, '1')">
                <div class="markerIconWrapper">
                    <img class="markerIcon" src="images/icons/marker_green.png" alt="marker icon">
                </div>
                <p class="markerDesc">Test-Felds</p>
            </div>
            </div>
        </div>
    </div>
    <script>
        // You can also require other files to run in this process
        const dotenv = require('dotenv');

        require('./renderer.js');
        const App = require('./App.js');
        const signs = require('./signs.js');

        function initMap() {

            dotenv.config();

            minZoomLevel = 18;

            App.map = new google.maps.Map(document.getElementById('map'), {
              zoom: minZoomLevel,
              minZoom: minZoomLevel,
              center: {lat: 51.141929, lng: 14.980407},
              draggableCursor: 'crosshair',
              streetViewControl: false,
              //fullscreenControl: false,
              mapTypeControl: false
            });

            let bounds = new google.maps.LatLngBounds(
              new google.maps.LatLng(51.140760, 14.978550),
              new google.maps.LatLng(51.143140, 14.982280));

            google.maps.event.addListener(App.map, 'dragend', function() {
                if(bounds.contains(App.map.getCenter())) return;

                let c = App.map.getCenter(),
                    x = c.lng(),
                    y = c.lat(),
                    maxX = bounds.getNorthEast().lng(),
                    maxY = bounds.getNorthEast().lat(),
                    minX = bounds.getSouthWest().lng(),
                    minY = bounds.getSouthWest().lat();

                if(x < minX) x = minX;
                if(x > maxX) x = maxX;
                if(y < minY) y = minY;
                if(y > maxY) y = maxY;

                App.map.setCenter(new google.maps.LatLng(y,x));

            });

            google.maps.event.addListener(App.map, 'click', function() {
                unselectMarker();
            });

            new USGSOverlay(bounds, './images/map/TP-Map.png', App.map);

            App.dbConfig = {
              apiKey: process.env.API_KEY,
              authDomain: process.env.AUTH_DOMAIN,
              databaseURL: process.env.DB_URL,
              projectId: process.env.PROJECT_ID,
              storageBucket: process.env.STORAGE_BUCKET,
              messagingSenderId: process.env.MSG_SENDER_ID
            }

            firebase.initializeApp(App.dbConfig);
            App.database = firebase.database();

            signs.getCategories((err, categories) => {
              if(!err){
                signs.Categories = categories;
                renderFilters();

              }else{
                //ERRORMELDUNG
                console.log(err);
              }
            });

            signs.loadSigns();

            console.log(App.signList);

        }

        google.maps.event.addDomListener(window, 'load', initMap);

    </script>
  </body>
</html>
